{% extends 'mango/base.html' %}
{% load staticfiles %}

{% block body_block %}

<div class="pricing-header px-3 py-3 pt-md-5 pb-md-4 mx-auto text-center">
        <h1 class="display-4">Mango Money</h1>
        {% if user.is_authenticated %}
            <p class="lead">    
                Here is a summary of your accounts           
            </p>
        {% else %}
            <p class="lead">    
                Please sign in to view summary of accounts
            </p>
        {% endif %}
</div>

<div class="container">
    <!-- Flex Box -->
    <div class="d-flex flex-column">

        {% if user.is_authenticated %}



            <form method="POST">
                    {% csrf_token %}
                    {{ query_form }}
                <button type="submit">Make Query</button>
            </form>


            <div>
                <p>The number of transactions is {{ number_transaction }} </p>
                <p>The average amount per transaction is {{ average_transaction }}</p>
                <p>The total is {{ sum_transaction }}</p>

            </div>
            <table>
                <tr>
                    <th>Name</th>
                    <th>Account</th>
                    <th>Amount</th>
                    <th>Location</th>
                    <th>Category</th>
                    <th>date</th>
                </tr>
                {% for item in allTransactions %}
                <tr>
                    <td>{{ item.transaction_name }}</td>
                    <td>{{ item.account_name }}</td>
                    <td>{{ item.transaction_amount }}</td>
                    <td>{{ item.transaction_location }}</td>
                    <td>{{ item.category_name }}</td>
                    <td>{{ item.transaction_date }}</td>

                </tr>
                {% endfor %}
            </table>


<!-- ***************************************************************************************** -->
<script src="https://unpkg.com/axios/dist/axios.min.js"></script>  
<style>
        #map{
          height:400px;
          width:100%;
        }
</style>
<div id="map"></div>
<script>
  // geocode();
  // function geocode(){
  //   // Prevent actual submit
  //   var location = '10607 Palm Spring';

  //   axios.get('https://maps.googleapis.com/maps/api/geocode/json',{
  //     params:{
  //       address:location,
  //       key:'AIzaSyCIazL1Lf3GC4O5gVhJSkbdcyqsTqt9R2I'
  //     }
  //   })
  //   .then(function(response){
  //     // Log full response
  //     console.log(response);
  //     latCoord = response.data.results[0].geometry.location.lat;
  //     lngCoord = response.data.results[0].geometry.location.lng;
  //     // console.log(latCoord);
  //     // Formatted Address
  //   })
  //   // console.log(response.data.results[0].geometry.location.lat)
  //   .catch(function(error){
  //     console.log(error);
  //   });
  //   // console.log(latCoord);
  // }
  // // console.log(latCoord);
  function initMap(){
    // console.log(latCoord);
    // Map options
    var location = '322 Stadium Drive Tallahassee, Fl';

    axios.get('https://maps.googleapis.com/maps/api/geocode/json',{
    params:{
      address:location,
      key:'AIzaSyCIazL1Lf3GC4O5gVhJSkbdcyqsTqt9R2I'
    }
    })
    .then(function(response){
      // Log full response
      console.log(response);
      latCoord = response.data.results[0].geometry.location.lat;
      lngCoord = response.data.results[0].geometry.location.lng;
      // console.log(latCoord);
      // Formatted Address
    
    var options = {
      zoom:17,
      center:{lat:latCoord,lng:lngCoord}
    }

    // New map
    var map = new google.maps.Map(document.getElementById('map'), options);

    // Listen for click on map
    google.maps.event.addListener(map, 'click', function(event){
      // Add marker
      addMarker({coords:event.latLng});
    });

    /*
    // Add marker
    var marker = new google.maps.Marker({
      position:{lat:42.4668,lng:-70.9495},
      map:map,
      icon:'https://developers.google.com/maps/documentation/javascript/examples/full/images/beachflag.png'
    });

    var infoWindow = new google.maps.InfoWindow({
      content:'<h1>Lynn MA</h1>'
    });

    marker.addListener('click', function(){
      infoWindow.open(map, marker);
    });
    */

    // Array of markers
    var markers = [
      {
        coords:{lat:latCoord,lng:lngCoord},
        content:'<h1></h1>'
      }
    ];

    // Loop through markers
    for(var i = 0;i < markers.length;i++){
      // Add marker
      addMarker(markers[i]);
    }

    // Add Marker Function
    function addMarker(props){
      var marker = new google.maps.Marker({
        position:props.coords,
        map:map,
        //icon:props.iconImage
      });

      // Check for customicon
      if(props.iconImage){
        // Set icon image
        marker.setIcon(props.iconImage);
      }

      // Check content
      if(props.content){
        var infoWindow = new google.maps.InfoWindow({
          content:props.content
        });

        marker.addListener('click', function(){
          infoWindow.open(map, marker);
        });
      }
    }
    })
  }
</script>
<script async defer
  src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCIazL1Lf3GC4O5gVhJSkbdcyqsTqt9R2I&callback=initMap">
  </script>





<!-- ***************************************************************************************** -->

        {% else %}
            <p>    
                Not Signed in
            </p>
        {% endif %}


    </div>
</div>
{% endblock %}